create database POWERBI

USE powerbi
create table ONIBUS(
ID_ONIBUS int primary key identity(1,1),
ONIBUS_NUMERO varchar(255)
)


create table GARAGEM(
ID_GARAGEM int primary key identity(1,1),
PC int,
LOTE varchar(100),
GARAGEM varchar(255)
)



create table LINHA(
ID_LINHA int primary key identity(1,1),
SUBSISTEMA varchar(200),
LINHA varchar(100),
DESCRICAO varchar(255),
EMPRESA int foreign key references garagem(ID_garagem)
)


create table GEO(
ID_GEO int primary key identity(1,1),
HORA_INICIAL datetime,
HORA_FINAL datetime,
SEQ int,
LATITUDE float,
LONGITUDE float,
PONTONOTAVEL int,
PNDESCRICAO varchar(255),
SENTIDO varchar(200),
CARRO int foreign key references Onibus(ID_Onibus),
LINHA int foreign key references linha(ID_linha)
)


CREATE TABLE CARTAO (
ID_REGISTRO INT PRIMARY KEY IDENTITY(1,1),
UTILIZACAO DATETIME,
N_CARTAO INT,
TIPO VARCHAR(255),
COODERNADAS INT FOREIGN KEY REFERENCES GEO(ID_GEO)
)


CREATE PROCEDURE COODERNADAS
AS
   SELECT C.UTILIZACAO AS DATA, C.N_CARTAO, C.TIPO, G.LATITUDE AS LATITUDE, G.LONGITUDE AS LONGITUDE, L.LINHA AS LINHA, L.DESCRICAO, O.ONIBUS_NUMERO, E.GARAGEM FROM CARTAO C INNER JOIN GEO G ON C.COODERNADAS = G.ID_GEO
   INNER JOIN LINHA L ON L.ID_LINHA = G.LINHA
   INNER JOIN ONIBUS O ON G.CARRO = O.ID_ONIBUS
   INNER JOIN GARAGEM E ON L.EMPRESA = E.ID_GARAGEM
GO

EXECUTE COODERNADAS




CREATE TABLE PASSAGEIRO_TRANSPARENCIA(
ID_TRANSPARENCIA INT PRIMARY KEY IDENTITY(1,1),
DATA DATETIME,
TOTALPASSAGEIRO INT,
LINHA INT FOREIGN KEY REFERENCES LINHA(ID_LINHA)
) 




CREATE TABLE CARGO(
ID_CARGO INT PRIMARY KEY IDENTITY(1,1),
DESCRICAO VARCHAR(255)
)






CREATE TABLE OPERADORES(
ID_FUNC INT PRIMARY KEY IDENTITY(1,1),
EMPRESA INT,
REGISTRO INT,
NOME VARCHAR(255),
ESCALA VARCHAR(255),
DATA_ADMISSAO DATE,
DATA_NASCIMENTO DATE,
STATUSFUNC BIT DEFAULT 1,

)




CREATE TABLE OPERADOR_KM(
ID INT PRIMARY KEY IDENTITY(1,1),
ID_OPERADOR INT FOREIGN KEY REFERENCES OPERADORES(ID_FUNC),
ID_BASEKM INT FOREIGN KEY REFERENCES KM_PASSAGEIRO(ID_VIAGEM)
)



CREATE TABLE KM_PASSAGEIRO(
ID_VIAGEM INT PRIMARY KEY IDENTITY(1,1),
DATA DATETIME,
TIPO_DIESEL VARCHAR(255),
NUMERO VARCHAR(255),
TOTALPASSAGEIRO INT,
KM FLOAT,
HORA_INICIAL DATETIME,
HORA_FINAL DATETIME,
LINHA INT FOREIGN KEY REFERENCES LINHA(ID_LINHA)
)





CREATE TABLE EVENTOS (
ID_EVENT INT PRIMARY KEY IDENTITY(1,1),
HORA_INICIAL DATETIME,
ORIGEM VARCHAR(255),
LATITUDE FLOAT,
LONGITUDE FLOAT,
CATEGORIA VARCHAR(200),
TIPO_EVENTO VARCHAR(255),
DESTINO VARCHAR(255),
VELOCIDADE FLOAT,
ID_VIAGEM INT FOREIGN KEY REFERENCES KM_PASSAGEIRO(ID_VIAGEM)
)
